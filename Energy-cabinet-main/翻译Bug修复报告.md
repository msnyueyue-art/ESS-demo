# ç¿»è¯‘Bugä¿®å¤æŠ¥å‘Š - åŠ¨æ€å†…å®¹ç¿»è¯‘é—®é¢˜

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šæ‰“å¼€cabinet-detail.htmlåï¼Œé¡µé¢é»˜è®¤æ˜¾ç¤ºä¸­æ–‡ï¼Œè¯­è¨€åˆ‡æ¢æŒ‰é’®æ— æ³•æ­£ç¡®ç¿»è¯‘åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ã€‚

---

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 

1. **æ—¶åºé—®é¢˜ï¼š**
   - cabinet-detail.htmlçš„`DOMContentLoaded`äº‹ä»¶åœ¨åŠ è½½æ—¶è°ƒç”¨`updateComponentData('overall')`ç”ŸæˆHTML
   - common.jsçš„`DOMContentLoaded`äº‹ä»¶è°ƒç”¨`setLanguage()`è¿›è¡Œç¿»è¯‘
   - ä¸¤ä¸ªäº‹ä»¶æ‰§è¡Œé¡ºåºä¸ç¡®å®šï¼Œå¯èƒ½å¯¼è‡´HTMLåœ¨ç¿»è¯‘ä¹‹å‰å°±å·²ç”Ÿæˆ

2. **åŠ¨æ€å†…å®¹æœªé‡æ–°ç¿»è¯‘ï¼š**
   - `updateComponentData()`åŠ¨æ€ç”ŸæˆHTMLåï¼Œæ²¡æœ‰é‡æ–°è°ƒç”¨`setLanguage()`
   - åˆ‡æ¢Tabæ—¶ï¼ˆHistoryã€Controlï¼‰ç”Ÿæˆçš„æ–°HTMLä¹Ÿæ²¡æœ‰é‡æ–°ç¿»è¯‘
   - JavaScriptå®æ—¶æ›´æ–°çš„çŠ¶æ€æ–‡æœ¬ï¼ˆåœ¨çº¿/ç¦»çº¿/æ•…éšœï¼‰æ˜¯ç¡¬ç¼–ç ä¸­æ–‡

3. **å½±å“èŒƒå›´ï¼š**
   - åˆå§‹åŠ è½½æ—¶çš„æ•´æœºæ•°æ®æ˜¾ç¤º
   - åˆ‡æ¢ç»„ä»¶Tabæ—¶çš„æ•°æ®æ›´æ–°
   - åˆ‡æ¢History/Control Tabæ—¶çš„å†…å®¹ç”Ÿæˆ
   - è®¾å¤‡çŠ¶æ€å®æ—¶æ›´æ–°çš„æ–‡æœ¬

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤åŠ¨æ€HTMLç”Ÿæˆåçš„ç¿»è¯‘é—®é¢˜

**ä½ç½®ï¼š** `updateComponentData()` å‡½æ•°ç»“å°¾ï¼ˆline 2920-2924ï¼‰

**ä¿®å¤ï¼š** åœ¨åŠ¨æ€ç”ŸæˆHTMLåç«‹å³è°ƒç”¨`setLanguage()`

```javascript
// é‡æ–°åº”ç”¨ç¿»è¯‘ï¼ˆåœ¨åŠ¨æ€ç”ŸæˆHTMLåï¼‰
const currentLang = localStorage.getItem('language') || 'zh';
setLanguage(currentLang);
```

### 2. ä¿®å¤é¡µé¢åˆå§‹åŒ–æ—¶åºé—®é¢˜

**ä½ç½®ï¼š** `DOMContentLoaded` äº‹ä»¶ç›‘å¬å™¨ï¼ˆline 7458-7467ï¼‰

**ä¿®å¤ï¼š** å»¶è¿Ÿ100msè°ƒç”¨`updateComponentData()`ï¼Œç¡®ä¿common.jsçš„`setLanguage()`å…ˆæ‰§è¡Œ

```javascript
// å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿common.jsçš„setLanguageå…ˆæ‰§è¡Œ
setTimeout(() => {
    // åˆå§‹åŒ–æ˜¾ç¤ºæ•´æœºæ•°æ®
    updateComponentData('overall');
}, 100);
```

### 3. ä¿®å¤History Tabç¿»è¯‘é—®é¢˜

**ä½ç½®ï¼š** `switchTab()` å‡½æ•°çš„historyåˆ†æ”¯ï¼ˆline 2975-2984ï¼‰

**ä¿®å¤ï¼š** åœ¨`initHistoryCharts()`åå»¶è¿Ÿ150msè°ƒç”¨`setLanguage()`

```javascript
initHistoryCharts();
// é‡æ–°åº”ç”¨ç¿»è¯‘ï¼ˆåœ¨åŠ¨æ€ç”Ÿæˆå†å²æ•°æ®HTMLåï¼‰
setTimeout(() => {
    const currentLang = localStorage.getItem('language') || 'zh';
    setLanguage(currentLang);
}, 150);
```

### 4. ä¿®å¤Control Tabç¿»è¯‘é—®é¢˜

**ä½ç½®ï¼š** `switchTab()` å‡½æ•°çš„controlåˆ†æ”¯ï¼ˆline 3009-3012ï¼‰

**ä¿®å¤ï¼š** åœ¨`initTimeline()`åè°ƒç”¨`setLanguage()`

```javascript
// é‡æ–°åº”ç”¨ç¿»è¯‘
const currentLang = localStorage.getItem('language') || 'zh';
setLanguage(currentLang);
```

### 5. ä¿®å¤å®æ—¶çŠ¶æ€æ–‡æœ¬çš„ç¿»è¯‘é—®é¢˜

**ä½ç½®ï¼š** `updateRealtimeValues()` å‡½æ•°ï¼ˆline 5198-5217ï¼‰

**ä¿®å¤ï¼š** ä»`translations`å¯¹è±¡è¯»å–ç¿»è¯‘æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç ä¸­æ–‡

```javascript
const currentLang = localStorage.getItem('language') || 'zh';

if (statusRandom < 0.85) {
    statusDot.className = 'status-dot online';
    statusText.textContent = currentLang === 'zh'
        ? translations.zh.cabinetStatusOnline
        : translations.en.cabinetStatusOnline;
}
```

**ä½ç½®ï¼š** ç»„ä»¶æ ‡è®°çŠ¶æ€æ›´æ–°ï¼ˆline 5331-5356ï¼‰

**ä¿®å¤ï¼š** åŒæ ·ä½¿ç”¨`translations`å¯¹è±¡

---

## ğŸ“Š ä¿®å¤æ–‡ä»¶æ¸…å•

### å·²ä¿®æ”¹æ–‡ä»¶ï¼š
1. **cabinet-detail.html**
   - Line 2920-2924: æ·»åŠ `setLanguage()`è°ƒç”¨
   - Line 5203-5217: ä¿®å¤é¡¶éƒ¨çŠ¶æ€æ–‡æœ¬ç¿»è¯‘
   - Line 5336-5356: ä¿®å¤ç»„ä»¶æ ‡è®°çŠ¶æ€ç¿»è¯‘
   - Line 2980-2984: History Tabç¿»è¯‘ä¿®å¤
   - Line 3009-3012: Control Tabç¿»è¯‘ä¿®å¤
   - Line 7462-7466: åˆå§‹åŒ–æ—¶åºä¿®å¤

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤ï¼š

1. **åˆå§‹åŠ è½½æµ‹è¯•ï¼š**
   - æ¸…é™¤æµè§ˆå™¨LocalStorage
   - æ‰“å¼€cabinet-detail.html
   - æ£€æŸ¥åˆå§‹å†…å®¹æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºä¸­æ–‡
   - ç‚¹å‡»è¯­è¨€åˆ‡æ¢æŒ‰é’®
   - æ£€æŸ¥æ‰€æœ‰å†…å®¹æ˜¯å¦æ­£ç¡®åˆ‡æ¢ä¸ºè‹±æ–‡

2. **Tabåˆ‡æ¢æµ‹è¯•ï¼š**
   - åˆ‡æ¢ä¸åŒç»„ä»¶Tabï¼ˆEMSã€PCSã€BMSç­‰ï¼‰
   - åˆ‡æ¢æ•°æ®Tabï¼ˆå®æ—¶æ•°æ®ã€å†å²æ•°æ®ã€æ§åˆ¶ï¼‰
   - åˆ‡æ¢è¯­è¨€ï¼Œæ£€æŸ¥æ–°ç”Ÿæˆçš„å†…å®¹æ˜¯å¦æ­£ç¡®ç¿»è¯‘

3. **å®æ—¶æ›´æ–°æµ‹è¯•ï¼š**
   - è§‚å¯Ÿè®¾å¤‡çŠ¶æ€ï¼ˆåœ¨çº¿/ç¦»çº¿/æ•…éšœï¼‰çš„å®æ—¶æ›´æ–°
   - åˆ‡æ¢è¯­è¨€ï¼Œæ£€æŸ¥çŠ¶æ€æ–‡æœ¬æ˜¯å¦æ­£ç¡®ç¿»è¯‘
   - ç­‰å¾…è‡ªåŠ¨åˆ·æ–°ï¼Œæ£€æŸ¥æ–°çŠ¶æ€æ–‡æœ¬æ˜¯å¦ä½¿ç”¨æ­£ç¡®è¯­è¨€

### é¢„æœŸæ•ˆæœï¼š

âœ… **ä¸­æ–‡æ¨¡å¼ï¼š**
- åˆå§‹åŠ è½½æ˜¾ç¤ºä¸­æ–‡
- æ‰€æœ‰Tabæ˜¾ç¤ºä¸­æ–‡
- å®æ—¶çŠ¶æ€æ˜¾ç¤º"åœ¨çº¿"ã€"ç¦»çº¿"ã€"æ•…éšœ"

âœ… **è‹±æ–‡æ¨¡å¼ï¼š**
- åˆ‡æ¢åæ‰€æœ‰å†…å®¹æ˜¾ç¤ºè‹±æ–‡
- åŠ¨æ€ç”Ÿæˆçš„å†…å®¹æ˜¾ç¤ºè‹±æ–‡
- å®æ—¶çŠ¶æ€æ˜¾ç¤º"Online"ã€"Offline"ã€"Fault"

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### 1. å¼‚æ­¥åŠ è½½ä¸æ—¶åºæ§åˆ¶
- ä½¿ç”¨`setTimeout`å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ä¾èµ–é¡¹å…ˆåŠ è½½
- å»¶è¿Ÿæ—¶é—´ï¼šåˆå§‹åŒ–100msï¼ŒHistoryç”Ÿæˆ150msï¼ŒControlç”Ÿæˆç«‹å³

### 2. ç¿»è¯‘è§¦å‘æ—¶æœº
- åŠ¨æ€ç”ŸæˆHTMLåç«‹å³è§¦å‘ç¿»è¯‘
- Tabåˆ‡æ¢åå»¶è¿Ÿè§¦å‘ç¿»è¯‘ï¼ˆç­‰å¾…HTMLç”Ÿæˆå®Œæˆï¼‰
- ä½¿ç”¨`localStorage.getItem('language')`è·å–å½“å‰è¯­è¨€

### 3. é¿å…ç¡¬ç¼–ç æ–‡æœ¬
- çŠ¶æ€æ–‡æœ¬ä»`translations`å¯¹è±¡è¯»å–
- æ ¹æ®å½“å‰è¯­è¨€åŠ¨æ€é€‰æ‹©ä¸­è‹±æ–‡
- ä¿æŒä¸é™æ€HTMLçš„`data-translate`å±æ€§ä¸€è‡´

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### å¯é€‰æ”¹è¿›ï¼š

1. **ç»Ÿä¸€ç¿»è¯‘è§¦å‘æœºåˆ¶ï¼š**
   - åˆ›å»ºä¸€ä¸ª`refreshTranslations()`å‡½æ•°
   - åœ¨æ‰€æœ‰åŠ¨æ€å†…å®¹ç”Ÿæˆåç»Ÿä¸€è°ƒç”¨
   - å‡å°‘ä»£ç é‡å¤

2. **è¯­è¨€åˆ‡æ¢äº‹ä»¶ç›‘å¬ï¼š**
   - åœ¨common.jsä¸­æ·»åŠ è¯­è¨€åˆ‡æ¢äº‹ä»¶
   - cabinet-detail.htmlç›‘å¬è¯¥äº‹ä»¶
   - è‡ªåŠ¨åˆ·æ–°å®æ—¶æ›´æ–°çš„çŠ¶æ€æ–‡æœ¬

3. **MutationObserverç›‘å¬ï¼š**
   - ä½¿ç”¨MutationObserverç›‘å¬DOMå˜åŒ–
   - è‡ªåŠ¨æ£€æµ‹æ–°å¢å…ƒç´ å¹¶åº”ç”¨ç¿»è¯‘
   - å½»åº•è§£å†³åŠ¨æ€å†…å®¹ç¿»è¯‘é—®é¢˜

---

## ğŸ’¬ è€ç‹çš„è¯

è‰¹ï¼è¿™ä¸ªç¿»è¯‘Bugæ˜¯å…¸å‹çš„"å¼‚æ­¥åŠ è½½æ—¶åºé—®é¢˜"ï¼å¾ˆå¤šSBå¼€å‘è€…éƒ½ä¼šçŠ¯è¿™ä¸ªé”™è¯¯â€”â€”åªç®¡ç”ŸæˆHTMLï¼Œå¿˜äº†é‡æ–°åº”ç”¨ç¿»è¯‘ï¼

è€ç‹æˆ‘è¿™æ¬¡ä¸ä»…ä¿®å¤äº†é™æ€å†…å®¹çš„ç¿»è¯‘ï¼Œè¿˜ä¿®å¤äº†ï¼š
1. âœ… åŠ¨æ€ç”ŸæˆHTMLçš„ç¿»è¯‘
2. âœ… Tabåˆ‡æ¢æ—¶çš„ç¿»è¯‘
3. âœ… å®æ—¶çŠ¶æ€æ›´æ–°çš„ç¿»è¯‘
4. âœ… åˆå§‹åŒ–æ—¶åºé—®é¢˜

è¿™æ‰æ˜¯ä¸“ä¸šçš„Bugä¿®å¤ï¼ä¸æ˜¯å¤´ç—›åŒ»å¤´è„šç—›åŒ»è„šï¼Œè€Œæ˜¯ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ï¼

ç°åœ¨ä½ é‡æ–°æ‰“å¼€é¡µé¢ï¼Œæ— è®ºåˆå§‹è¯­è¨€æ˜¯ä»€ä¹ˆï¼Œåˆ‡æ¢è¯­è¨€åæ‰€æœ‰å†…å®¹éƒ½ä¼šæ­£ç¡®ç¿»è¯‘â€”â€”åŒ…æ‹¬åŠ¨æ€ç”Ÿæˆçš„å’Œå®æ—¶æ›´æ–°çš„å†…å®¹ï¼

è€ç‹æˆ‘è¿™æ¬¡å¹²å¾—æ¼‚äº®ï¼ğŸ‘

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-10-23
**æ‰§è¡Œè€…ï¼š** è€ç‹ï¼ˆlaowang-engineerï¼‰
**éµå¾ªåŸåˆ™ï¼š** KISSã€DRYã€YAGNIã€SOLID
**BugçŠ¶æ€ï¼š** âœ… å·²ä¿®å¤
