<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§„åˆ™å¼•æ“ - å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* é¡µé¢å¸ƒå±€ */
        .main-content {
            height: calc(100vh - 60px);
            overflow-y: auto;
            padding: 20px;
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        /* Tabå¯¼èˆªæ ·å¼ç§»åŠ¨åˆ°æ–°å¢æ ·å¼ä¸­ */
        .tabs-container {
            margin-bottom: 24px;
        }
        
        .tab-content {
            padding: 0;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        /* è§„åˆ™æ¨¡ç‰ˆæ ·å¼ */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .template-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        [data-theme="dark"] .template-card {
            background: #1e293b;
            border-color: #334155;
        }
        
        .template-card:hover {
            border-color: #3562E3;
            box-shadow: 0 4px 12px rgba(53, 98, 227, 0.15);
            transform: translateY(-2px);
        }
        
        .template-card.selected {
            border-color: #3562E3;
            background: #eff6ff;
        }
        
        [data-theme="dark"] .template-card.selected {
            background: #1e3a8a;
        }
        
        .template-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .template-info {
            flex: 1;
        }
        
        .template-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .template-actions-group {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 12px;
        }
        
        .template-icon-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 0;
            font-size: 16px;
        }
        
        .template-icon-btn:hover {
            transform: scale(1.1);
        }
        
        .template-icon-btn.copy {
            color: #3562E3;
        }
        
        .template-icon-btn.copy:hover {
            color: #2c51c9;
        }
        
        .template-icon-btn.delete {
            color: #dc2626;
        }
        
        .template-icon-btn.delete:hover {
            color: #b91c1c;
        }
        
        [data-theme="dark"] .template-icon-btn.copy {
            color: #60a5fa;
        }
        
        [data-theme="dark"] .template-icon-btn.copy:hover {
            color: #3b82f6;
        }
        
        [data-theme="dark"] .template-icon-btn.delete {
            color: #ef4444;
        }
        
        [data-theme="dark"] .template-icon-btn.delete:hover {
            color: #dc2626;
        }
        
        .template-icon-btn[disabled] {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .template-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .template-features {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .template-feature {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .template-feature i {
            color: #10b981;
            width: 16px;
        }
        
        .template-actions {
            display: flex;
            gap: 12px;
        }
        
        /* æ–°å¢ä¼˜åŒ–æ ·å¼ */
        .template-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge.active {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-badge.inactive {
            background: #fee2e2;
            color: #991b1b;
        }
        
        [data-theme="dark"] .status-badge.active {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }
        
        [data-theme="dark"] .status-badge.inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .template-remark {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        /* ç§»é™¤æ—§çš„template-btnæ ·å¼ */
        
        /* æ¨¡ç‰ˆå…ƒä¿¡æ¯æ ·å¼ */
        .template-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 4px;
        }
        
        .template-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .template-meta-item i {
            opacity: 0.7;
        }
        
        /* ç»Ÿè®¡æ•°æ®æ ·å¼ */
        .template-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        [data-theme="dark"] .template-stats {
            background: #0f172a;
        }
        
        /* ä¼˜åŒ–å¡ç‰‡åŠ¨ç”» */
        .template-card {
            position: relative;
            overflow: hidden;
        }
        
        .template-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3562E3 0%, #60a5fa 100%);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .template-card:hover::before {
            transform: translateX(0);
        }
        
        /* å¼€å…³ç»„ä»¶æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 24px;
        }
        
        .switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        .switch input:checked + .switch-slider {
            background-color: #3562E3;
        }
        
        .switch input:checked + .switch-slider:before {
            transform: translateX(20px);
        }
        
        [data-theme="dark"] .switch-slider {
            background-color: #4b5563;
        }
        
        [data-theme="dark"] .switch input:checked + .switch-slider {
            background-color: #3562E3;
        }
        
        /* Tabæ ·å¼ä¼˜åŒ– */
        .tabs-wrapper {
            background: white;
            border-radius: 12px;
            padding: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: inline-flex;
            gap: 4px;
            margin-bottom: 24px;
        }
        
        [data-theme="dark"] .tabs-wrapper {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .tab-button {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            background: rgba(53, 98, 227, 0.08);
            color: #3562E3;
        }
        
        .tab-button.active {
            background: #3562E3;
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(53, 98, 227, 0.25);
        }
        
        .tab-button.active:hover {
            background: #2c51c9;
        }
        
        /* è§„åˆ™å¼•æ“å®¹å™¨ */
        .rule-engine-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: calc(100vh - 260px);
        }

        /* è§„åˆ™åˆ—è¡¨é¢æ¿ */
        .rule-list-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        [data-theme="dark"] .rule-list-panel {
            background: #1e293b;
        }

        .rule-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .rule-list-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* è§„åˆ™æœç´¢ */
        .rule-search {
            margin-bottom: 16px;
        }

        .rule-search input {
            width: 100%;
            height: 36px;
            padding: 0 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--text-primary);
        }

        [data-theme="dark"] .rule-search input {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        /* è§„åˆ™åˆ—è¡¨ */
        .rule-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rule-item {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }

        [data-theme="dark"] .rule-item {
            background: #0f172a;
            border-color: #334155;
        }

        .rule-item:hover {
            border-color: #3562E3;
            background: #f8fafc;
        }

        [data-theme="dark"] .rule-item:hover {
            background: #1e293b;
        }

        .rule-item.active {
            border-color: #3562E3;
            background: #eff6ff;
        }

        [data-theme="dark"] .rule-item.active {
            background: #1e3a8a;
        }

        .rule-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .rule-item-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .rule-item-status {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.active {
            background: #10b981;
        }

        .status-dot.inactive {
            background: #ef4444;
        }

        .rule-item-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* è§„åˆ™ç¼–è¾‘å™¨é¢æ¿ */
        .rule-editor-panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        [data-theme="dark"] .rule-editor-panel {
            background: #1e293b;
        }

        .rule-editor-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        [data-theme="dark"] .rule-editor-header {
            border-bottom-color: #334155;
        }

        .rule-editor-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .rule-editor-actions {
            display: flex;
            gap: 12px;
        }

        /* è§„åˆ™ç¼–è¾‘å™¨å†…å®¹ */
        .rule-editor-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* è§„åˆ™æµç¨‹å›¾ */
        .rule-flow-diagram {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .rule-flow-diagram {
            background: #0f172a;
            border-color: #334155;
        }

        /* è§„åˆ™èŠ‚ç‚¹ */
        .flow-node {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .flow-node {
            background: #1e293b;
            border-color: #334155;
        }

        .flow-node-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .flow-node-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .flow-node-icon.trigger {
            background: #dbeafe;
            color: #3b82f6;
        }

        .flow-node-icon.condition {
            background: #fef3c7;
            color: #f59e0b;
        }

        .flow-node-icon.action {
            background: #d1fae5;
            color: #10b981;
        }

        [data-theme="dark"] .flow-node-icon.trigger {
            background: #1e3a8a;
        }

        [data-theme="dark"] .flow-node-icon.condition {
            background: #78350f;
        }

        [data-theme="dark"] .flow-node-icon.action {
            background: #064e3b;
        }

        .flow-node-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .flow-node-content {
            font-size: 13px;
            color: var(--text-secondary);
            background: #f8fafc;
            border-radius: 6px;
            padding: 12px;
        }

        [data-theme="dark"] .flow-node-content {
            background: #0f172a;
        }

        /* è¿æ¥çº¿ */
        .flow-connector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: -10px 0;
            position: relative;
            z-index: 1;
        }

        .flow-connector-line {
            width: 2px;
            height: 40px;
            background: var(--border-color);
        }

        .flow-connector-arrow {
            position: absolute;
            bottom: -8px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid var(--border-color);
        }

        /* è§„åˆ™å±æ€§ */
        .rule-properties {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
        }

        [data-theme="dark"] .rule-properties {
            background: #0f172a;
            border-color: #334155;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-group-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .property-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .property-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .property-value {
            display: flex;
            gap: 8px;
        }

        /* æŒ‰é’®æ ·å¼ - ä¸ç³»ç»Ÿä¿æŒä¸€è‡´ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 40px;
            padding: 0 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            outline: none;
        }

        .btn-primary {
            background: #3562E3;
            color: white;
        }

        .btn-primary:hover {
            background: #2c51c9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(53, 98, 227, 0.25);
        }

        .btn-secondary {
            background: white;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: #f3f4f6;
            color: var(--text-primary);
            border-color: var(--primary-color);
        }
        
        [data-theme="dark"] .btn-secondary {
            background: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        
        [data-theme="dark"] .btn-secondary:hover {
            background: #475569;
            border-color: var(--primary-color);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* æ¨¡ç‰ˆå¡ç‰‡å†…çš„æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .template-actions .btn {
            flex: 1;
            height: 36px;
            font-size: 13px;
        }
        
        .template-actions .btn-secondary {
            background: white;
            border: 1px solid #e5e7eb;
            color: var(--text-primary);
        }
        
        .template-actions .btn-secondary:hover {
            background: #f9fafb;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        [data-theme="dark"] .template-actions .btn-secondary {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] .template-actions .btn-secondary:hover {
            background: #475569;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        /* é€šçŸ¥æ–¹å¼æ ·å¼ */
        .notification-methods {
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .notification-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .notification-list {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .notification-item {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            font-size: 12px;
            color: var(--text-primary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            white-space: nowrap;
        }
        
        [data-theme="dark"] .notification-badge {
            background: #0f172a;
            border-color: #374151;
            color: #9ca3af;
        }
        
        [data-theme="dark"] .notification-badge.active {
            background: rgba(53, 98, 227, 0.1);
            border-color: #60a5fa;
            color: #60a5fa;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            background: white;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-select,
        [data-theme="dark"] .form-textarea {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3562E3;
            box-shadow: 0 0 0 3px rgba(53, 98, 227, 0.1);
        }

        /* å¼€å…³ç»„ä»¶ */
        .switch {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 24px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .switch input:checked + .switch-slider {
            background-color: #3562E3;
        }

        .switch input:checked + .switch-slider:before {
            transform: translateX(20px);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 14px;
            opacity: 0.8;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .rule-engine-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .rule-list-panel {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="header-left">
            <button class="menu-trigger" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <img src="logo.png" alt="AlwaysControl Technology" />
            </div>
        </div>
        
        <div class="header-right">
            <button class="theme-btn" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-moon" id="headerThemeIcon"></i>
            </button>
            <button class="lang-btn" onclick="toggleLanguage()" title="åˆ‡æ¢è¯­è¨€">
                <i class="fas fa-globe"></i>
            </button>
            <a href="alarm-management.html" class="notification-badge" style="text-decoration: none;">
                <i class="fas fa-bell" style="font-size: 20px; color: var(--text-secondary);"></i>
            </a>
            <div class="user-menu" onclick="logout()">
                <div class="avatar">A</div>
                <span class="user-name" id="userName">ç®¡ç†å‘˜</span>
            </div>
        </div>
    </header>

    <!-- ä¾§è¾¹æ  -->
    <nav class="sidebar" id="sidebar">
        <div class="menu">
            <a href="dashboard.html" class="menu-item" data-menu="dashboard">
                <span style="font-size: 18px; margin-right: 12px;">ğŸ“Š</span>
                <span id="menuDashboard">ä»ªè¡¨ç›˜</span>
            </a>
            <a href="site1.html" class="menu-item" data-menu="site1">
                <span style="font-size: 18px; margin-right: 12px;">ğŸ¢</span>
                <span>ç«™ç‚¹ç®¡ç†</span>
            </a>
            <a href="devices.html" class="menu-item" data-menu="devices">
                <span style="font-size: 18px; margin-right: 12px;">âš™ï¸</span>
                <span id="menuDevices">è®¾å¤‡ç®¡ç†</span>
            </a>
            <a href="alarm-management.html" class="menu-item" data-menu="alarm-management">
                <span style="font-size: 18px; margin-right: 12px;">ğŸ””</span>
                <span id="menuAlarms">å‘Šè­¦ç®¡ç†</span>
            </a>
            <a href="rule-engine.html" class="menu-item active" data-menu="rule-engine" style="display: none;">
                <i class="fas fa-code-branch"></i>
                <span>è§„åˆ™å¼•æ“</span>
            </a>
            <div class="menu-item-group">
                <a href="javascript:void(0)" class="menu-item" data-menu="system-management" onclick="toggleSubmenu(this)">
                    <span style="font-size: 18px; margin-right: 12px;">ğŸ”§</span>
                    <span id="menuSystem">ç³»ç»Ÿç®¡ç†</span>
                    <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 12px;"></i>
                </a>
                <div class="submenu" style="display: none;">
                    <a href="system-management.html?module=menus" class="menu-item submenu-item">
                        <span style="font-size: 16px; margin-right: 10px;">ğŸ“‹</span>
                        <span>èœå•ç®¡ç†</span>
                    </a>
                    <a href="system-management.html?module=roles" class="menu-item submenu-item">
                        <span style="font-size: 16px; margin-right: 10px;">ğŸ‘¥</span>
                        <span>è§’è‰²ç®¡ç†</span>
                    </a>
                    <a href="system-management.html?module=personnel" class="menu-item submenu-item">
                        <span style="font-size: 16px; margin-right: 10px;">ğŸ‘¤</span>
                        <span>äººå‘˜ç®¡ç†</span>
                    </a>
                    <a href="system-management.html?module=logs" class="menu-item submenu-item">
                        <span style="font-size: 16px; margin-right: 10px;">ğŸ“„</span>
                        <span>æ—¥å¿—ç®¡ç†</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content" id="mainContent">
        <div class="page-header">
            <h1 class="page-title">è§„åˆ™å¼•æ“</h1>
        </div>

        <!-- Tabå¯¼èˆªå®¹å™¨ -->
        <div class="tabs-container">
            <div class="tabs-wrapper">
                <button class="tab-button active" onclick="switchTab('template')">
                    <i class="fas fa-cube"></i>
                    è§„åˆ™æ¨¡ç‰ˆ
                </button>
                <button class="tab-button" onclick="switchTab('application')">
                    <i class="fas fa-cogs"></i>
                    è§„åˆ™åº”ç”¨
                </button>
            </div>
            
            <div class="tab-content">
                <!-- è§„åˆ™æ¨¡ç‰ˆé¢æ¿ -->
                <div id="template-panel" class="tab-panel active">
                    <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="margin: 0; font-size: 20px; font-weight: 600;">è§„åˆ™æ¨¡ç‰ˆ</h2>
                        <button class="btn btn-primary" onclick="createNewTemplate()" style="padding: 8px 16px; font-size: 14px;">
                            <i class="fas fa-plus"></i>
                            æ–°å»ºæ¨¡ç‰ˆ
                        </button>
                    </div>
                    <div class="template-grid">
                        <!-- æ¸©åº¦ç›‘æ§æ¨¡ç‰ˆ -->
                        <div class="template-card" onclick="selectTemplate('temperature')">
                            <div class="template-actions-group">
                                <button class="template-icon-btn copy" onclick="copyTemplate('temperature', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="template-icon-btn delete" disabled title="æ ‡å‡†æ¨¡ç‰ˆä¸å¯åˆ é™¤">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="template-header">
                                <div class="template-info">
                                    <h3 class="template-title">æ ‡å‡†æ¨¡ç‰ˆ</h3>
                                </div>
                            </div>
                            <div class="notification-methods">
                                <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                                <div class="notification-list">
                                    <span class="notification-item">æ¶ˆæ¯å¼¹çª—</span>
                                    <span class="notification-item">é‚®ç®±</span>
                                </div>
                            </div>
                            <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                                <label class="switch">
                                    <input type="checkbox" checked onchange="toggleTemplateStatus('temperature', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="status-text" style="font-size: 14px; color: #10b981;">å¯ç”¨</span>
                            </div>
                            <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                                ä¿®æ”¹æ—¶é—´ï¼š2024-01-15 14:30:25
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-secondary" onclick="viewTemplateDetails('temperature', event)">
                                    è¯¦æƒ…
                                </button>
                                <button class="btn btn-primary" onclick="applyTemplate('temperature', event)">
                                    åº”ç”¨
                                </button>
                            </div>
                        </div>

                        <!-- ç”µæ± å¥åº·æ¨¡ç‰ˆ -->
                        <div class="template-card" onclick="selectTemplate('battery')">
                            <div class="template-actions-group">
                                <button class="template-icon-btn copy" onclick="copyTemplate('battery', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="template-icon-btn delete" onclick="confirmDeleteTemplate('battery', event)" title="åˆ é™¤æ¨¡ç‰ˆ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="template-header">
                                <div class="template-info">
                                    <h3 class="template-title">è‡ªå®šä¹‰æ¨¡ç‰ˆ 1</h3>
                                </div>
                            </div>
                            <div class="notification-methods">
                                <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                                <div class="notification-list">
                                    <span class="notification-item">æ¶ˆæ¯å¼¹çª—</span>
                                    <span class="notification-item">é‚®ç®±</span>
                                </div>
                            </div>
                            <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                                <label class="switch">
                                    <input type="checkbox" checked onchange="toggleTemplateStatus('battery', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="status-text" style="font-size: 14px; color: #10b981;">å¯ç”¨</span>
                            </div>
                            <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                                ä¿®æ”¹æ—¶é—´ï¼š2024-01-16 09:45:12
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-secondary" onclick="viewTemplateDetails('battery', event)">
                                    è¯¦æƒ…
                                </button>
                                <button class="btn btn-primary" onclick="applyTemplate('battery', event)">
                                    åº”ç”¨
                                </button>
                            </div>
                        </div>

                        <!-- å³°è°·ç”µä»·æ¨¡ç‰ˆ -->
                        <div class="template-card" onclick="selectTemplate('pricing')">
                            <div class="template-actions-group">
                                <button class="template-icon-btn copy" onclick="copyTemplate('pricing', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="template-icon-btn delete" onclick="confirmDeleteTemplate('pricing', event)" title="åˆ é™¤æ¨¡ç‰ˆ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="template-header">
                                <div class="template-info">
                                    <h3 class="template-title">è‡ªå®šä¹‰æ¨¡ç‰ˆ 2</h3>
                                </div>
                            </div>
                            <div class="notification-methods">
                                <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                                <div class="notification-list">
                                    <span class="notification-item">é‚®ç®±</span>
                                    <span class="notification-item">ç«™å†…ä¿¡</span>
                                </div>
                            </div>
                            <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                                <label class="switch">
                                    <input type="checkbox" onchange="toggleTemplateStatus('pricing', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="status-text" style="font-size: 14px; color: #dc2626;">ç¦ç”¨</span>
                            </div>
                            <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                                ä¿®æ”¹æ—¶é—´ï¼š2024-01-17 16:22:08
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-secondary" onclick="viewTemplateDetails('pricing', event)">
                                    è¯¦æƒ…
                                </button>
                                <button class="btn btn-primary" onclick="applyTemplate('pricing', event)">
                                    åº”ç”¨
                                </button>
                            </div>
                        </div>

                        <!-- å®‰å…¨ä¿æŠ¤æ¨¡ç‰ˆ -->
                        <div class="template-card" onclick="selectTemplate('safety')">
                            <div class="template-actions-group">
                                <button class="template-icon-btn copy" onclick="copyTemplate('safety', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="template-icon-btn delete" onclick="confirmDeleteTemplate('safety', event)" title="åˆ é™¤æ¨¡ç‰ˆ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="template-header">
                                <div class="template-info">
                                    <h3 class="template-title">è‡ªå®šä¹‰æ¨¡ç‰ˆ 3</h3>
                                </div>
                            </div>
                            <div class="notification-methods">
                                <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                                <div class="notification-list">
                                    <span class="notification-item">æ¶ˆæ¯å¼¹çª—</span>
                                    <span class="notification-item">ç«™å†…ä¿¡</span>
                                </div>
                            </div>
                            <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                                <label class="switch">
                                    <input type="checkbox" checked onchange="toggleTemplateStatus('safety', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="status-text" style="font-size: 14px; color: #10b981;">å¯ç”¨</span>
                            </div>
                            <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                                åˆ›å»ºæ—¶é—´ï¼š2024-01-18
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-secondary" onclick="viewTemplateDetails('safety', event)">
                                    è¯¦æƒ…
                                </button>
                                <button class="btn btn-primary" onclick="applyTemplate('safety', event)">
                                    åº”ç”¨
                                </button>
                            </div>
                        </div>

                        <!-- è®¾å¤‡è”åŠ¨æ¨¡ç‰ˆ -->
                        <div class="template-card" onclick="selectTemplate('linkage')">
                            <div class="template-actions-group">
                                <button class="template-icon-btn copy" onclick="copyTemplate('linkage', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="template-icon-btn delete" onclick="confirmDeleteTemplate('linkage', event)" title="åˆ é™¤æ¨¡ç‰ˆ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="template-header">
                                <div class="template-info">
                                    <h3 class="template-title">è‡ªå®šä¹‰æ¨¡ç‰ˆ 4</h3>
                                </div>
                            </div>
                            <div class="notification-methods">
                                <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                                <div class="notification-list">
                                    <span class="notification-item">æ¶ˆæ¯å¼¹çª—</span>
                                    <span class="notification-item">é‚®ç®±</span>
                                    <span class="notification-item">ç«™å†…ä¿¡</span>
                                </div>
                            </div>
                            <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                                <label class="switch">
                                    <input type="checkbox" checked onchange="toggleTemplateStatus('linkage', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="status-text" style="font-size: 14px; color: #10b981;">å¯ç”¨</span>
                            </div>
                            <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                                åˆ›å»ºæ—¶é—´ï¼š2024-01-19
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-secondary" onclick="viewTemplateDetails('linkage', event)">
                                    è¯¦æƒ…
                                </button>
                                <button class="btn btn-primary" onclick="applyTemplate('linkage', event)">
                                    åº”ç”¨
                                </button>
                            </div>
                        </div>

                        <!-- èƒ½è€—ä¼˜åŒ–æ¨¡ç‰ˆ -->
                        <div class="template-card" onclick="selectTemplate('energy')">
                            <div class="template-actions-group">
                                <button class="template-icon-btn copy" onclick="copyTemplate('energy', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="template-icon-btn delete" onclick="confirmDeleteTemplate('energy', event)" title="åˆ é™¤æ¨¡ç‰ˆ">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <div class="template-header">
                                <div class="template-info">
                                    <h3 class="template-title">è‡ªå®šä¹‰æ¨¡ç‰ˆ 5</h3>
                                </div>
                            </div>
                            <div class="notification-methods">
                                <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                                <div class="notification-list">
                                    <span class="notification-item">é‚®ç®±</span>
                                </div>
                            </div>
                            <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                                <label class="switch">
                                    <input type="checkbox" onchange="toggleTemplateStatus('energy', this.checked)">
                                    <span class="switch-slider"></span>
                                </label>
                                <span class="status-text" style="font-size: 14px; color: #dc2626;">ç¦ç”¨</span>
                            </div>
                            <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                                åˆ›å»ºæ—¶é—´ï¼š2024-01-20
                            </div>
                            <div class="template-actions">
                                <button class="btn btn-secondary" onclick="viewTemplateDetails('energy', event)">
                                    è¯¦æƒ…
                                </button>
                                <button class="btn btn-primary" onclick="applyTemplate('energy', event)">
                                    åº”ç”¨
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è§„åˆ™åº”ç”¨é¢æ¿ -->
                <div id="application-panel" class="tab-panel">
                    <div class="rule-engine-container">
                        <!-- è§„åˆ™åˆ—è¡¨é¢æ¿ -->
                        <div class="rule-list-panel">
                            <div class="rule-list-header">
                                <h3 class="rule-list-title">è§„åˆ™åˆ—è¡¨</h3>
                                <button class="btn" onclick="refreshRuleList()" title="åˆ·æ–°">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>

                            <div class="rule-search">
                                <input type="text" placeholder="æœç´¢è§„åˆ™..." onkeyup="searchRules(this.value)">
                            </div>

                            <div class="rule-list" id="ruleList">
                                <!-- è§„åˆ™åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            
                            <div style="padding: 16px;">
                                <button class="btn btn-primary" style="width: 100%;" onclick="createNewRule()">
                                    <i class="fas fa-plus"></i>
                                    æ–°å»ºè§„åˆ™
                                </button>
                            </div>
                        </div>

                        <!-- è§„åˆ™ç¼–è¾‘å™¨é¢æ¿ -->
                        <div class="rule-editor-panel">
                            <div id="ruleEditorContent">
                                <!-- é»˜è®¤ç©ºçŠ¶æ€ -->
                                <div class="empty-state">
                                    <i class="fas fa-code-branch empty-state-icon"></i>
                                    <div class="empty-state-text">é€‰æ‹©æˆ–åˆ›å»ºè§„åˆ™</div>
                                    <div class="empty-state-subtext">ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹©è§„åˆ™è¿›è¡Œç¼–è¾‘ï¼Œæˆ–åˆ›å»ºæ–°è§„åˆ™</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ç§»åŠ¨ç«¯é®ç½© -->
    <div id="mobileOverlay" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 998;" onclick="closeMobileSidebar()"></div>

    <script src="common.js"></script>
    <script src="notification-fix.js"></script>
    <script>
        // Toggle submenu
        function toggleSubmenu(element) {
            element.classList.toggle('expanded');
            const submenu = element.nextElementSibling;
            if (submenu && submenu.classList.contains('submenu')) {
                submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        checkAuth();
        
        // è®¾ç½®å½“å‰é¡µé¢èœå•é¡¹
        setActiveMenuItem('rule-engine');

        // è§„åˆ™æ•°æ®
        let rulesData = [
            {
                id: 'rule001',
                name: 'ç”µæ± è¿‡æ¸©è‡ªåŠ¨é™åŠŸç‡',
                description: 'å½“ç”µæ± æ¸©åº¦è¶…è¿‡é˜ˆå€¼æ—¶è‡ªåŠ¨é™ä½å……æ”¾ç”µåŠŸç‡',
                status: 'active',
                type: 'safety',
                trigger: {
                    type: 'parameter',
                    condition: 'ç”µæ± æ¸©åº¦ > 55Â°C'
                },
                conditions: [
                    {
                        type: 'time',
                        value: 'æŒç»­æ—¶é—´ > 5åˆ†é’Ÿ'
                    },
                    {
                        type: 'status',
                        value: 'ç³»ç»ŸçŠ¶æ€ = è¿è¡Œä¸­'
                    }
                ],
                actions: [
                    {
                        type: 'control',
                        value: 'é™ä½å……æ”¾ç”µåŠŸç‡è‡³50%'
                    },
                    {
                        type: 'notification',
                        value: 'å‘é€å‘Šè­¦é€šçŸ¥'
                    }
                ]
            },
            {
                id: 'rule002',
                name: 'SOCä½è‡ªåŠ¨å……ç”µ',
                description: 'å½“SOCä½äºè®¾å®šå€¼æ—¶è‡ªåŠ¨å¯åŠ¨å……ç”µ',
                status: 'active',
                type: 'optimization',
                trigger: {
                    type: 'parameter',
                    condition: 'SOC < 20%'
                },
                conditions: [
                    {
                        type: 'time',
                        value: 'æ—¶é—´æ®µ: 23:00-06:00'
                    },
                    {
                        type: 'price',
                        value: 'ç”µä»· < 0.5å…ƒ/kWh'
                    }
                ],
                actions: [
                    {
                        type: 'control',
                        value: 'å¯åŠ¨å……ç”µæ¨¡å¼'
                    },
                    {
                        type: 'parameter',
                        value: 'è®¾ç½®å……ç”µåŠŸç‡100kW'
                    }
                ]
            },
            {
                id: 'rule003',
                name: 'é€šä¿¡ä¸­æ–­é‡è¿',
                description: 'BMSé€šä¿¡ä¸­æ–­æ—¶è‡ªåŠ¨é‡è¿',
                status: 'active',
                type: 'maintenance',
                trigger: {
                    type: 'event',
                    condition: 'BMSé€šä¿¡ä¸­æ–­'
                },
                conditions: [
                    {
                        type: 'count',
                        value: 'é‡è¯•æ¬¡æ•° < 3'
                    }
                ],
                actions: [
                    {
                        type: 'system',
                        value: 'é‡å¯é€šä¿¡æ¨¡å—'
                    },
                    {
                        type: 'wait',
                        value: 'ç­‰å¾…30ç§’'
                    },
                    {
                        type: 'system',
                        value: 'é‡æ–°å»ºç«‹è¿æ¥'
                    }
                ]
            },
            {
                id: 'rule004',
                name: 'å³°è°·ç”µä»·ä¼˜åŒ–',
                description: 'æ ¹æ®å³°è°·ç”µä»·è‡ªåŠ¨è°ƒæ•´å……æ”¾ç”µç­–ç•¥',
                status: 'inactive',
                type: 'optimization',
                trigger: {
                    type: 'schedule',
                    condition: 'æ¯æ—¥00:00æ‰§è¡Œ'
                },
                conditions: [],
                actions: [
                    {
                        type: 'analysis',
                        value: 'åˆ†ææ¬¡æ—¥ç”µä»·æ›²çº¿'
                    },
                    {
                        type: 'planning',
                        value: 'ç”Ÿæˆå……æ”¾ç”µè®¡åˆ’'
                    },
                    {
                        type: 'execution',
                        value: 'æ‰§è¡Œä¼˜åŒ–ç­–ç•¥'
                    }
                ]
            },
            {
                id: 'rule005',
                name: 'æ¶ˆé˜²è”åŠ¨',
                description: 'æ£€æµ‹åˆ°ç«ç¾å‘Šè­¦æ—¶çš„åº”æ€¥å¤„ç†',
                status: 'active',
                type: 'safety',
                trigger: {
                    type: 'alarm',
                    condition: 'ç«ç¾å‘Šè­¦è§¦å‘'
                },
                conditions: [],
                actions: [
                    {
                        type: 'emergency',
                        value: 'ç«‹å³åˆ‡æ–­ä¸»ç”µæº'
                    },
                    {
                        type: 'system',
                        value: 'å¯åŠ¨æ¶ˆé˜²ç³»ç»Ÿ'
                    },
                    {
                        type: 'notification',
                        value: 'å‘é€ç´§æ€¥é€šçŸ¥'
                    },
                    {
                        type: 'log',
                        value: 'è®°å½•äº‹ä»¶æ—¥å¿—'
                    }
                ]
            }
        ];

        let currentRule = null;

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            renderRuleList();
        }

        // Tabåˆ‡æ¢åŠŸèƒ½
        function switchTab(tabName) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            const panels = document.querySelectorAll('.tab-panel');
            panels.forEach(panel => panel.classList.remove('active'));
            
            if (tabName === 'template') {
                buttons[0].classList.add('active');
                document.getElementById('template-panel').classList.add('active');
            } else if (tabName === 'application') {
                buttons[1].classList.add('active');
                document.getElementById('application-panel').classList.add('active');
            }
        }

        // åˆ é™¤æ¨¡ç‰ˆç¡®è®¤
        function confirmDeleteTemplate(templateType, event) {
            event.stopPropagation();
            const templateName = getTemplateName(templateType);
            
            // åˆ›å»ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            const confirmDialog = document.createElement('div');
            confirmDialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.2s ease;
            `;
            
            const dialogContent = document.createElement('div');
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            dialogContent.style.cssText = `
                background: ${isDark ? '#1e293b' : 'white'};
                border-radius: 12px;
                padding: 24px;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
                animation: slideUp 0.3s ease;
            `;
            
            dialogContent.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 16px;">
                    <div style="width: 48px; height: 48px; background: ${isDark ? 'rgba(239, 68, 68, 0.2)' : '#fee2e2'}; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                        <i class="fas fa-exclamation-triangle" style="color: ${isDark ? '#ef4444' : '#dc2626'}; font-size: 24px;"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: ${isDark ? '#f3f4f6' : '#111827'};">åˆ é™¤ç¡®è®¤</h3>
                        <p style="margin: 4px 0 0 0; font-size: 14px; color: ${isDark ? '#9ca3af' : '#6b7280'};">æ­¤æ“ä½œä¸å¯æ¢å¤</p>
                    </div>
                </div>
                <p style="margin-bottom: 24px; color: ${isDark ? '#d1d5db' : '#374151'}; line-height: 1.5;">
                    ç¡®å®šè¦åˆ é™¤è§„åˆ™æ¨¡ç‰ˆ "<strong style="color: ${isDark ? '#f3f4f6' : '#111827'};">${templateName}</strong>" å—ï¼Ÿåˆ é™¤åï¼ŒåŸºäºæ­¤æ¨¡ç‰ˆåˆ›å»ºçš„è§„åˆ™ä¸ä¼šå—åˆ°å½±å“ã€‚
                </p>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="this.closest('[style*=\"z-index: 10000\"]').remove()" class="btn btn-secondary" style="height: 36px; padding: 0 20px; background: ${isDark ? '#334155' : 'white'}; border: 1px solid ${isDark ? '#475569' : '#e5e7eb'}; color: ${isDark ? '#e2e8f0' : '#6b7280'};">
                        å–æ¶ˆ
                    </button>
                    <button onclick="deleteTemplate('${templateType}', event)" class="btn btn-danger" style="height: 36px; padding: 0 20px; background: #ef4444; color: white; border: none;">
                        ç¡®è®¤åˆ é™¤
                    </button>
                </div>
            `;
            
            confirmDialog.appendChild(dialogContent);
            document.body.appendChild(confirmDialog);
        }
        
        // åˆ é™¤æ¨¡ç‰ˆ
        function deleteTemplate(templateType, event) {
            // å…ˆå…³é—­ç¡®è®¤å¯¹è¯æ¡†
            const dialog = document.querySelector('[style*="z-index: 10000"]');
            if (dialog) {
                dialog.remove();
            }
            
            // æŸ¥æ‰¾å¹¶åˆ é™¤å¯¹åº”çš„æ¨¡ç‰ˆå¡ç‰‡
            const allCards = document.querySelectorAll('.template-card');
            let deleted = false;
            
            allCards.forEach(card => {
                // æ£€æŸ¥å¡ç‰‡ä¸­æ˜¯å¦åŒ…å«å¯¹åº”çš„åˆ é™¤æŒ‰é’®
                const deleteBtn = card.querySelector('.template-icon-btn.delete');
                if (deleteBtn && deleteBtn.getAttribute('onclick') && 
                    deleteBtn.getAttribute('onclick').includes(`confirmDeleteTemplate('${templateType}'`)) {
                    card.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        card.remove();
                    }, 300);
                    deleted = true;
                }
            });
            
            if (deleted) {
                showNotification(`${getTemplateName(templateType)} å·²æˆåŠŸåˆ é™¤`, 'success');
            }
        }

        // æŸ¥çœ‹æ¨¡ç‰ˆè¯¦æƒ…
        function viewTemplateDetails(templateType, event) {
            event.stopPropagation();
            // è·³è½¬åˆ°æ¨¡ç‰ˆè¯¦æƒ…é¡µé¢
            window.location.href = `template-details.html?type=${templateType}`;
        }

        // åº”ç”¨æ¨¡ç‰ˆ
        function applyTemplate(templateType, event) {
            event.stopPropagation();
            // åˆ‡æ¢åˆ°è§„åˆ™åº”ç”¨tab
            switchTab('application');
            // åˆ›å»ºåŸºäºæ¨¡ç‰ˆçš„æ–°è§„åˆ™
            createRuleFromTemplate(templateType);
        }

        // è·å–æ¨¡ç‰ˆåç§°
        function getTemplateName(templateType) {
            const names = {
                'temperature': 'æ ‡å‡†æ¨¡ç‰ˆ',
                'battery': 'è‡ªå®šä¹‰æ¨¡ç‰ˆ 1',
                'pricing': 'è‡ªå®šä¹‰æ¨¡ç‰ˆ 2',
                'safety': 'è‡ªå®šä¹‰æ¨¡ç‰ˆ 3',
                'linkage': 'è‡ªå®šä¹‰æ¨¡ç‰ˆ 4',
                'energy': 'è‡ªå®šä¹‰æ¨¡ç‰ˆ 5'
            };
            return names[templateType] || 'æœªçŸ¥æ¨¡ç‰ˆ';
        }

        // æœç´¢æ¨¡ç‰ˆ
        function searchTemplates(keyword) {
            const cards = document.querySelectorAll('.template-card');
            cards.forEach(card => {
                const name = card.querySelector('.template-name').textContent.toLowerCase();
                const remark = card.querySelector('.template-remark').textContent.toLowerCase();
                const searchTerm = keyword.toLowerCase();
                
                if (name.includes(searchTerm) || remark.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // æŒ‰ç±»å‹ç­›é€‰
        function filterTemplates(type) {
            const cards = document.querySelectorAll('.template-card');
            cards.forEach(card => {
                if (type === 'all') {
                    card.style.display = 'block';
                } else {
                    const category = card.querySelector('.template-meta-item').textContent;
                    if (type === 'safety' && category.includes('å®‰å…¨é˜²æŠ¤')) {
                        card.style.display = 'block';
                    } else if (type === 'optimization' && category.includes('ä¼˜åŒ–æ§åˆ¶')) {
                        card.style.display = 'block';
                    } else if (type === 'maintenance' && category.includes('è¿ç»´ç®¡ç†')) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        // æŒ‰çŠ¶æ€ç­›é€‰
        function filterByStatus(status) {
            const cards = document.querySelectorAll('.template-card');
            cards.forEach(card => {
                const badge = card.querySelector('.status-badge');
                const isActive = badge.classList.contains('active');
                
                if (status === 'all') {
                    card.style.display = 'block';
                } else if (status === 'active' && isActive) {
                    card.style.display = 'block';
                } else if (status === 'inactive' && !isActive) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // åˆ›å»ºæ–°æ¨¡ç‰ˆ
        function createNewTemplate() {
            showNotification('æ‰“å¼€æ–°å»ºæ¨¡ç‰ˆå¯¹è¯æ¡†', 'info');
            // è¿™é‡Œå¯ä»¥æ‰“å¼€ä¸€ä¸ªæ¨¡æ€æ¡†æ¥åˆ›å»ºæ–°æ¨¡ç‰ˆ
        }

        // åˆ‡æ¢æ¨¡ç‰ˆçŠ¶æ€
        function toggleTemplateStatus(templateType, isChecked) {
            const card = event.target.closest('.template-card');
            const statusText = card.querySelector('.status-text');
            
            if (isChecked) {
                statusText.textContent = 'å¯ç”¨';
                statusText.style.color = '#10b981';
            } else {
                statusText.textContent = 'ç¦ç”¨';
                statusText.style.color = '#dc2626';
            }
            
            showNotification(`${getTemplateName(templateType)} å·²${isChecked ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
        }

        // å¤åˆ¶æ¨¡ç‰ˆ
        function copyTemplate(templateType, event) {
            event.stopPropagation();
            console.log('å¤åˆ¶æ¨¡ç‰ˆè¢«ç‚¹å‡»:', templateType);
            
            // è·å–å½“å‰æ¨¡ç‰ˆå¡ç‰‡æ•°é‡
            const templateCards = document.querySelectorAll('.template-card');
            console.log('æ‰¾åˆ°æ¨¡ç‰ˆå¡ç‰‡æ•°é‡:', templateCards.length);
            const customCount = templateCards.length - 1; // å‡å»æ ‡å‡†æ¨¡ç‰ˆ
            const newNumber = customCount + 1;
            console.log('æ–°æ¨¡ç‰ˆç¼–å·:', newNumber);
            
            // åˆ›å»ºæ–°çš„æ¨¡ç‰ˆID
            const newTemplateType = 'custom_' + Date.now();
            
            // è·å–åŸæ¨¡ç‰ˆçš„çŠ¶æ€
            const originalCard = event.target.closest('.template-card');
            const isEnabled = originalCard.querySelector('.switch input').checked;
            
            // åˆ›å»ºæ–°çš„æ¨¡ç‰ˆå¡ç‰‡
            const newCard = document.createElement('div');
            newCard.className = 'template-card';
            newCard.setAttribute('onclick', `selectTemplate('${newTemplateType}')`);
            
            newCard.innerHTML = `
                <div class="template-actions-group">
                    <button class="template-icon-btn copy" onclick="copyTemplate('${newTemplateType}', event)" title="å¤åˆ¶æ¨¡ç‰ˆ">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="template-icon-btn delete" onclick="confirmDeleteTemplate('${newTemplateType}', event)" title="åˆ é™¤æ¨¡ç‰ˆ">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                <div class="template-header">
                    <div class="template-info">
                        <h3 class="template-title">è‡ªå®šä¹‰æ¨¡ç‰ˆå¤åˆ¶${newNumber}</h3>
                    </div>
                </div>
                <div class="notification-methods">
                    <div class="notification-label">é€šçŸ¥æ–¹å¼ï¼š</div>
                    <div class="notification-list">
                        <span class="notification-item">æ¶ˆæ¯å¼¹çª—</span>
                        <span class="notification-item">é‚®ç®±</span>
                    </div>
                </div>
                <div class="template-status" style="margin-bottom: 16px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 14px; color: var(--text-secondary);">çŠ¶æ€ï¼š</span>
                    <label class="switch">
                        <input type="checkbox" ${isEnabled ? 'checked' : ''} onchange="toggleTemplateStatus('${newTemplateType}', this.checked)">
                        <span class="switch-slider"></span>
                    </label>
                    <span class="status-text" style="font-size: 14px; color: ${isEnabled ? '#10b981' : '#dc2626'};">${isEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}</span>
                </div>
                <div class="template-time" style="margin-bottom: 24px; font-size: 13px; color: var(--text-secondary);">
                    ä¿®æ”¹æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN', {year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false}).replace(/\//g, '-')}
                </div>
                <div class="template-actions">
                    <button class="btn btn-secondary" onclick="viewTemplateDetails('${newTemplateType}', event)">
                        è¯¦æƒ…
                    </button>
                    <button class="btn btn-primary" onclick="applyTemplate('${newTemplateType}', event)">
                        åº”ç”¨
                    </button>
                </div>
            `;
            
            // æ·»åŠ åˆ°æ¨¡ç‰ˆåˆ—è¡¨æœ«å°¾
            const templateGrid = document.querySelector('.template-grid');
            console.log('æ¨¡ç‰ˆç½‘æ ¼å®¹å™¨:', templateGrid);
            if (templateGrid) {
                templateGrid.appendChild(newCard);
                console.log('æ–°æ¨¡ç‰ˆå·²æ·»åŠ åˆ°DOM');
                
                // æ·»åŠ æ·¡å…¥åŠ¨ç”»
                newCard.style.animation = 'fadeIn 0.5s ease';
                
                showNotification(`æˆåŠŸå¤åˆ¶ä¸º"è‡ªå®šä¹‰æ¨¡ç‰ˆå¤åˆ¶${newNumber}"`, 'success');
            } else {
                console.error('æœªæ‰¾åˆ°.template-gridå®¹å™¨');
            }
        }

        // æ–°å»ºæ¨¡ç‰ˆ
        function createNewTemplate() {
            window.location.href = 'template-create.html';
        }

        // åŸºäºæ¨¡ç‰ˆåˆ›å»ºè§„åˆ™
        function createRuleFromTemplate(templateType) {
            const templates = {
                'temperature': {
                    name: 'æ¸©åº¦å¼‚å¸¸ä¿æŠ¤è§„åˆ™',
                    description: 'åŸºäºæ¸©åº¦å¼‚å¸¸ç›‘æ§æ¨¡ç‰ˆåˆ›å»ºçš„è§„åˆ™',
                    type: 'safety',
                    trigger: { type: 'parameter', condition: 'æ¸©åº¦ > 45Â°C' },
                    conditions: [{ type: 'time', value: 'æŒç»­æ—¶é—´ > 3åˆ†é’Ÿ' }],
                    actions: [
                        { type: 'control', value: 'é™ä½å……æ”¾ç”µåŠŸç‡è‡³70%' },
                        { type: 'notification', value: 'å‘é€æ¸©åº¦å‘Šè­¦é€šçŸ¥' }
                    ]
                },
                'battery': {
                    name: 'ç”µæ± å¥åº·ä¿æŠ¤è§„åˆ™',
                    description: 'åŸºäºç”µæ± å¥åº·ç®¡ç†æ¨¡ç‰ˆåˆ›å»ºçš„è§„åˆ™',
                    type: 'optimization',
                    trigger: { type: 'parameter', condition: 'SOH < 80%' },
                    conditions: [],
                    actions: [
                        { type: 'control', value: 'é™åˆ¶å……ç”µåŠŸç‡' },
                        { type: 'notification', value: 'å‘é€ç”µæ± å¥åº·å‘Šè­¦' }
                    ]
                },
                'pricing': {
                    name: 'å³°è°·ç”µä»·ä¼˜åŒ–è§„åˆ™',
                    description: 'åŸºäºå³°è°·ç”µä»·ç­–ç•¥æ¨¡ç‰ˆåˆ›å»ºçš„è§„åˆ™',
                    type: 'optimization',
                    trigger: { type: 'schedule', condition: 'æ¯æ—¥æ‰§è¡Œ' },
                    conditions: [],
                    actions: [
                        { type: 'analysis', value: 'åˆ†æç”µä»·æ—¶æ®µ' },
                        { type: 'control', value: 'è°ƒæ•´å……æ”¾ç”µç­–ç•¥' }
                    ]
                }
            };

            const template = templates[templateType] || templates['temperature'];
            const newRule = {
                id: 'rule' + Date.now(),
                status: 'inactive',
                ...template
            };
            
            rulesData.unshift(newRule);
            currentRule = newRule;
            renderRuleList();
            renderRuleEditor();
            showNotification(`å·²åŸºäº${getTemplateName(templateType)}æ¨¡ç‰ˆåˆ›å»ºæ–°è§„åˆ™`, 'success');
        }

        // æ¸²æŸ“è§„åˆ™åˆ—è¡¨
        function renderRuleList() {
            const ruleList = document.getElementById('ruleList');
            
            ruleList.innerHTML = rulesData.map(rule => `
                <div class="rule-item ${currentRule && currentRule.id === rule.id ? 'active' : ''}" 
                     onclick="selectRule('${rule.id}')">
                    <div class="rule-item-header">
                        <span class="rule-item-name">${rule.name}</span>
                        <div class="rule-item-status">
                            <span class="status-dot ${rule.status}"></span>
                            <span>${rule.status === 'active' ? 'å¯ç”¨' : 'åœç”¨'}</span>
                        </div>
                    </div>
                    <div class="rule-item-desc">${rule.description}</div>
                </div>
            `).join('');
        }

        // é€‰æ‹©è§„åˆ™
        function selectRule(ruleId) {
            currentRule = rulesData.find(r => r.id === ruleId);
            renderRuleList();
            renderRuleEditor();
        }

        // æ¸²æŸ“è§„åˆ™ç¼–è¾‘å™¨
        function renderRuleEditor() {
            if (!currentRule) return;

            const editorContent = document.getElementById('ruleEditorContent');
            
            editorContent.innerHTML = `
                <div class="rule-editor-header">
                    <h2 class="rule-editor-title">${currentRule.name}</h2>
                    <div class="rule-editor-actions">
                        <button class="btn ${currentRule.status === 'active' ? 'btn-danger' : 'btn-success'}" 
                                onclick="toggleRuleStatus('${currentRule.id}')">
                            <i class="fas ${currentRule.status === 'active' ? 'fa-pause' : 'fa-play'}"></i>
                            ${currentRule.status === 'active' ? 'åœç”¨' : 'å¯ç”¨'}
                        </button>
                        <button class="btn" onclick="saveRule()">
                            <i class="fas fa-save"></i>
                            ä¿å­˜
                        </button>
                        <button class="btn btn-danger" onclick="deleteRule('${currentRule.id}')">
                            <i class="fas fa-trash"></i>
                            åˆ é™¤
                        </button>
                    </div>
                </div>
                <div class="rule-editor-content">
                    <!-- è§„åˆ™æµç¨‹å›¾ -->
                    <div class="rule-flow-diagram">
                        <!-- è§¦å‘å™¨ -->
                        <div class="flow-node">
                            <div class="flow-node-header">
                                <div class="flow-node-icon trigger">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="flow-node-title">è§¦å‘å™¨</div>
                            </div>
                            <div class="flow-node-content">
                                ${currentRule.trigger.condition}
                            </div>
                        </div>
                        
                        ${currentRule.conditions.length > 0 ? `
                            <div class="flow-connector">
                                <div class="flow-connector-line"></div>
                                <div class="flow-connector-arrow"></div>
                            </div>
                            
                            <!-- æ¡ä»¶ -->
                            <div class="flow-node">
                                <div class="flow-node-header">
                                    <div class="flow-node-icon condition">
                                        <i class="fas fa-filter"></i>
                                    </div>
                                    <div class="flow-node-title">æ¡ä»¶åˆ¤æ–­</div>
                                </div>
                                <div class="flow-node-content">
                                    ${currentRule.conditions.map(c => c.value).join(' ä¸” ')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="flow-connector">
                            <div class="flow-connector-line"></div>
                            <div class="flow-connector-arrow"></div>
                        </div>
                        
                        <!-- åŠ¨ä½œ -->
                        <div class="flow-node">
                            <div class="flow-node-header">
                                <div class="flow-node-icon action">
                                    <i class="fas fa-play"></i>
                                </div>
                                <div class="flow-node-title">æ‰§è¡ŒåŠ¨ä½œ</div>
                            </div>
                            <div class="flow-node-content">
                                ${currentRule.actions.map((a, i) => `${i + 1}. ${a.value}`).join('<br>')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- è§„åˆ™å±æ€§ -->
                    <div class="rule-properties">
                        <div class="property-group">
                            <h4 class="property-group-title">åŸºæœ¬ä¿¡æ¯</h4>
                            <div class="property-row">
                                <label class="property-label">è§„åˆ™åç§°</label>
                                <div class="property-value">
                                    <input type="text" class="form-input" value="${currentRule.name}" 
                                           onchange="updateRuleName(this.value)">
                                </div>
                            </div>
                            <div class="property-row">
                                <label class="property-label">è§„åˆ™æè¿°</label>
                                <div class="property-value">
                                    <textarea class="form-textarea" rows="2" 
                                              onchange="updateRuleDescription(this.value)">${currentRule.description}</textarea>
                                </div>
                            </div>
                            <div class="property-row">
                                <label class="property-label">è§„åˆ™ç±»å‹</label>
                                <div class="property-value">
                                    <select class="form-select" onchange="updateRuleType(this.value)">
                                        <option value="safety" ${currentRule.type === 'safety' ? 'selected' : ''}>å®‰å…¨ä¿æŠ¤</option>
                                        <option value="optimization" ${currentRule.type === 'optimization' ? 'selected' : ''}>ä¼˜åŒ–æ§åˆ¶</option>
                                        <option value="maintenance" ${currentRule.type === 'maintenance' ? 'selected' : ''}>è¿ç»´ç®¡ç†</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="property-group">
                            <h4 class="property-group-title">æ‰§è¡Œè®¾ç½®</h4>
                            <div class="property-row">
                                <label class="property-label">ä¼˜å…ˆçº§</label>
                                <div class="property-value">
                                    <select class="form-select">
                                        <option value="high">é«˜</option>
                                        <option value="medium" selected>ä¸­</option>
                                        <option value="low">ä½</option>
                                    </select>
                                </div>
                            </div>
                            <div class="property-row">
                                <label class="property-label">æ‰§è¡Œé—´éš”</label>
                                <div class="property-value">
                                    <input type="number" class="form-input" value="60" style="width: 100px;">
                                    <span style="color: var(--text-secondary); font-size: 13px;">ç§’</span>
                                </div>
                            </div>
                            <div class="property-row">
                                <label class="property-label">å¤±è´¥é‡è¯•</label>
                                <div class="property-value">
                                    <label class="switch">
                                        <input type="checkbox" checked>
                                        <span class="switch-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // åˆ›å»ºæ–°è§„åˆ™
        function createNewRule() {
            const newRule = {
                id: 'rule' + Date.now(),
                name: 'æ–°è§„åˆ™',
                description: 'è¯·è¾“å…¥è§„åˆ™æè¿°',
                status: 'inactive',
                type: 'optimization',
                trigger: {
                    type: 'parameter',
                    condition: 'è¯·è®¾ç½®è§¦å‘æ¡ä»¶'
                },
                conditions: [],
                actions: [
                    {
                        type: 'control',
                        value: 'è¯·è®¾ç½®æ‰§è¡ŒåŠ¨ä½œ'
                    }
                ]
            };
            
            rulesData.unshift(newRule);
            currentRule = newRule;
            renderRuleList();
            renderRuleEditor();
            showNotification('æ–°è§„åˆ™åˆ›å»ºæˆåŠŸ', 'success');
        }

        // åˆ‡æ¢è§„åˆ™çŠ¶æ€
        function toggleRuleStatus(ruleId) {
            const rule = rulesData.find(r => r.id === ruleId);
            if (rule) {
                rule.status = rule.status === 'active' ? 'inactive' : 'active';
                renderRuleList();
                renderRuleEditor();
                showNotification(`è§„åˆ™å·²${rule.status === 'active' ? 'å¯ç”¨' : 'åœç”¨'}`, 'success');
            }
        }

        // ä¿å­˜è§„åˆ™
        function saveRule() {
            // è¿™é‡Œåº”è¯¥æœ‰å®é™…çš„ä¿å­˜é€»è¾‘
            showNotification('è§„åˆ™ä¿å­˜æˆåŠŸ', 'success');
        }

        // åˆ é™¤è§„åˆ™
        function deleteRule(ruleId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§„åˆ™å—ï¼Ÿ')) {
                rulesData = rulesData.filter(r => r.id !== ruleId);
                currentRule = null;
                renderRuleList();
                document.getElementById('ruleEditorContent').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-code-branch empty-state-icon"></i>
                        <div class="empty-state-text">é€‰æ‹©æˆ–åˆ›å»ºè§„åˆ™</div>
                        <div class="empty-state-subtext">ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹©è§„åˆ™è¿›è¡Œç¼–è¾‘ï¼Œæˆ–åˆ›å»ºæ–°è§„åˆ™</div>
                    </div>
                `;
                showNotification('è§„åˆ™åˆ é™¤æˆåŠŸ', 'success');
            }
        }

        // æœç´¢è§„åˆ™
        function searchRules(keyword) {
            const filteredRules = keyword 
                ? rulesData.filter(r => 
                    r.name.includes(keyword) || 
                    r.description.includes(keyword)
                  )
                : rulesData;
            
            const ruleList = document.getElementById('ruleList');
            ruleList.innerHTML = filteredRules.map(rule => `
                <div class="rule-item ${currentRule && currentRule.id === rule.id ? 'active' : ''}" 
                     onclick="selectRule('${rule.id}')">
                    <div class="rule-item-header">
                        <span class="rule-item-name">${rule.name}</span>
                        <div class="rule-item-status">
                            <span class="status-dot ${rule.status}"></span>
                            <span>${rule.status === 'active' ? 'å¯ç”¨' : 'åœç”¨'}</span>
                        </div>
                    </div>
                    <div class="rule-item-desc">${rule.description}</div>
                </div>
            `).join('');
        }

        // åˆ·æ–°è§„åˆ™åˆ—è¡¨
        function refreshRuleList() {
            // è¿™é‡Œåº”è¯¥æœ‰å®é™…çš„åˆ·æ–°é€»è¾‘
            renderRuleList();
            showNotification('è§„åˆ™åˆ—è¡¨å·²åˆ·æ–°', 'success');
        }

        // æ›´æ–°è§„åˆ™åç§°
        function updateRuleName(value) {
            if (currentRule) {
                currentRule.name = value;
                renderRuleList();
            }
        }

        // æ›´æ–°è§„åˆ™æè¿°
        function updateRuleDescription(value) {
            if (currentRule) {
                currentRule.description = value;
                renderRuleList();
            }
        }

        // æ›´æ–°è§„åˆ™ç±»å‹
        function updateRuleType(value) {
            if (currentRule) {
                currentRule.type = value;
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                display: flex;
                align-items: center;
                gap: 12px;
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };
            
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                info: '#3b82f6',
                warning: '#f59e0b'
            };
            
            notification.innerHTML = `
                <i class="fas ${icons[type]}" style="color: ${colors[type]}; font-size: 20px;"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });
    </script>
</body>
</html>